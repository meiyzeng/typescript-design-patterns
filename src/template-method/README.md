## Typescript 设计模式之模板方法

### 一、简介

模板方式模式是一种只需使用继承就可以实现的非常简单的模式。

模板方法模式由两部分结构组成，第一部分是抽象父类，第二部分是具体的实现子类。通常在抽象父类中封装了子类的算法框架，也包括实现一些公共方法以及封装子类中所有方法的执行顺序。子类通过继承这个抽象类，也继承了整个算法结构，并且可以选择重写父类的方法。

### 二、优缺点

#### 优点

- 在父类中形式化地定义一个算法，而由它的子类来实现细节的处理，在子类实现详细的处理算法时并不会改变算法中步骤的执行次序。
- 模板方法模式是一种代码复用技术，它在类库设计中尤为重要，它提取了类库中的公共行为，将公共行为放在父类中，而通过子类来实现不同的行为，它鼓励我们恰当使用继承来实现代码复用。
- 可实现一种反向控制结构，通过子类覆盖父类的钩子方法来决定某一特定步骤是否需要执行。
- 在模板方法模式中可以通过子类来覆盖父类的基本方法，不同的子类可以提供基本方法的不同实现，更换和增加新的子类很方便，符合单一职责原则和开闭原则。

#### 缺点

- 需要为每一个基本方法的不同实现提供一个子类，如果父类中可变的基本方法太多，将会导致类的个数增加，系统更加庞大，设计也更加抽象。此时，可以结合桥接模式来进行设计。

### 三、应用场景

- 一个类不知道它所需要的对象的类：在工厂方法模式中，客户端不需要知道具体产品类的类名，只需要知道所对应的工厂即可，具体的产品对象由具体工厂类创建；客户端需要知道创建具体产品的工厂类。
- 一个类通过其子类来指定创建哪个对象：在工厂方法模式中，对于抽象工厂类只需要提供一个创建产品的接口，而由其子类来确定具体要创建的对象，利用面向对象的多态性和里氏代换原则，在程序运行时，子类对象将覆盖父类对象，从而使得系统更容易扩展。

### 四、模式结构

模板方法模式包含以下角色：

* AbstractClass（抽象类）：在抽象类中定义了一系列基本操作 （PrimitiveOperations），这些基本操作可以是具体的，也可以是抽象的，每一个基本操作对应算法的一个步骤，在其子类中可以重定义或实现这些步骤。同时，在抽象类中实现了一个模板方法，用于定义一个算法的框架，模板方法不仅可以调用在抽象类中实现的基本方法，也可以调用在抽象类的子类中实现的基本方法，还可以调用其他对象中的方法。


* ConcreteClass（具体子类）：它是抽象类的子类，用于实现在父类中声明的抽象基本操作以完成子类特定算法的步骤，也可以覆盖在父类中已经实现的具体基本操作。

![template-method](template-method.png)

### 五、实战

咖啡与茶是一个经典的例子，经常用来讲解模板方法模式。

首先，我们先来泡一杯咖啡，如果没有什么太个性化的需求，泡咖啡的步骤通常如下：

1. 把水煮沸
2. 用沸水冲泡咖啡
3. 把咖啡倒进杯子
4. 加糖和牛奶

接下来，开始准备我们的茶，泡茶的步骤跟泡咖啡的步骤相差并不大：

1. 把水煮沸
2. 用沸水浸泡茶叶
3. 把茶水倒进杯子
4. 加柠檬

我们分别泡好了一杯咖啡和一壶茶，经过思考和比较，我们发现咖啡和茶的冲泡过程是大同小异的，如表 11-1 所示。

|   泡咖啡   |   泡茶    |
| :-----: | :-----: |
|  把水煮沸   |  把水煮沸   |
| 用沸水冲泡咖啡 | 用沸水浸泡茶叶 |
| 把咖啡倒进杯子 | 把茶水倒进杯子 |
|  加糖和牛奶  |   加柠檬   |

我们找到泡咖啡和泡茶主要有以下不同点：

- 原料不同。一个是咖啡，一个是茶，但我们可以把它们都抽象为 "饮料"。
- 泡的方式不同。咖啡是冲泡，而茶叶是浸泡，我们可以把它们都抽象为 "泡"。
- 加入的调料不同。一个是糖和牛奶，一个是柠檬，但我们可以把它们都抽象为 "调料"。

经过抽象之后，不管是泡咖啡还是泡茶，我们都能整理为下面四步：

1. 把水煮沸
2. 用沸水冲泡饮料
3. 把饮料倒进杯子
4. 加调料

所以，不管是冲泡还是浸泡，我们都能给它一个新的方法名称，比如说 brew()。同理，不管是加糖和牛奶，还是加柠檬，我们都可以称之为 addCondiments()。

现在我们可以创建一个抽象父类来表示泡一杯饮料的整个过程。不论是 Coffee，还是 Tea，都被我们用 Beverage 来表示，最后我们来看一下具体实现。

#### 具体实现

创建 Beverage 抽象类 

```typescript
abstract class Beverage {
    boilWater() {
      console.log("把水煮沸");
    }

    abstract brew(): void;
    abstract pourInCup(): void;
    abstract addCondiments(): void;

    // 模板方法
    makeBeverage() { 
      this.boilWater();
      this.brew();
      this.pourInCup();
      this.addCondiments();
    }
}
```

创建 Coffee 类

```typescript
export class Coffee extends Beverage {
    brew(): void {
      console.log("用沸水冲泡咖啡");
    }
    pourInCup(): void {
      console.log("把咖啡倒进杯子");
    }
    addCondiments(): void {
      throw new Error("加糖和牛奶");
    }
}
```

创建 Tea 类

```typescript
export class Tea extends Beverage {
    brew(): void {
      console.log("用沸水浸泡茶叶");
    }
    pourInCup(): void {
      console.log("把茶倒进杯子");
    }
    addCondiments(): void {
      console.log("加柠檬");
    }
}
```

#### 使用示例

```typescript
export function show(): void {
      const coffee: TemplateMethodPattern.Coffee = new TemplateMethodPattern.Coffee();
      const tea: TemplateMethodPattern.Tea = new TemplateMethodPattern.Tea();
      coffee.makeBeverage();
      tea.makeBeverage();
}
```

